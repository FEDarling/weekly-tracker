(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{644:function(e,t,a){"use strict";a.r(t);var s=a(10),n=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("p",[a("img",{attrs:{src:"https://web-dev.imgix.net/image/IypihH3o5cSpEMVp5i08dp69otp2/Orid6fbbep03o45XkRis.jpeg?auto=format&w=1600",alt:""}})]),e._v(" "),a("p",[e._v("Images are a common source of performance bottlenecks for web applications and a key focus area for optimization. Unoptimized images "),a("a",{attrs:{href:"https://almanac.httparchive.org/en/2020/page-weight#image-bytes",target:"_blank",rel:"noopener noreferrer"}},[e._v("contribute to page bloat"),a("OutboundLink")],1),e._v(' and currently account for over 70% of the total page weight in bytes at the 90th percentile. Multiple ways to optimize images call for an intelligent "image component" with performance solutions baked in as a default.')]),e._v(" "),a("p",[e._v("The "),a("a",{attrs:{href:"https://web.dev/introducing-aurora/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Aurora"),a("OutboundLink")],1),e._v(" team worked with "),a("a",{attrs:{href:"https://nextjs.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Next.js"),a("OutboundLink")],1),e._v(" to build "),a("a",{attrs:{href:"https://nextjs.org/docs/basic-features/image-optimization#image-component",target:"_blank",rel:"noopener noreferrer"}},[e._v("one such component"),a("OutboundLink")],1),e._v(". The goal was to create an optimized image template that web developers could further customize. The component serves as a good model and sets a standard for building image components in other frameworks, content management systems (CMS), and tech-stacks. We have collaborated on a similar component for "),a("a",{attrs:{href:"https://image.nuxtjs.org/components/nuxt-img/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Nuxt.js"),a("OutboundLink")],1),e._v(", and we are working with "),a("a",{attrs:{href:"https://angular.io/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Angular"),a("OutboundLink")],1),e._v(" on image optimization in future versions. This post discusses how we designed the Next.js Image component and the lessons we learned along the way.")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://web-dev.imgix.net/image/IypihH3o5cSpEMVp5i08dp69otp2/NiUYg2hxW7Hi5LzdPWVo.png?auto=format&w=1500",alt:""}})]),e._v(" "),a("h2",{attrs:{id:"image-optimization-issues-and-opportunities"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#image-optimization-issues-and-opportunities"}},[e._v("#")]),e._v(" Image optimization issues and opportunities")]),e._v(" "),a("p",[e._v("Images not only affect performance, but also business. The number of images on a page was the second "),a("a",{attrs:{href:"https://almanac.httparchive.org/en/2019/page-weight#bigger-complex-pages-can-be-bad-for-your-business",target:"_blank",rel:"noopener noreferrer"}},[e._v("greatest predictor of conversions"),a("OutboundLink")],1),e._v(" of users visiting websites. Sessions in which users converted had 38% fewer images than sessions where they did not convert. Lighthouse lists multiple "),a("a",{attrs:{href:"https://web.dev/fast/#optimize-your-images",target:"_blank",rel:"noopener noreferrer"}},[e._v("opportunities"),a("OutboundLink")],1),e._v(" to optimize images and improve web vitals as part of its best practices audit. Some of the common areas where images can affect core "),a("a",{attrs:{href:"https://web.dev/vitals/",target:"_blank",rel:"noopener noreferrer"}},[e._v("web vitals"),a("OutboundLink")],1),e._v(", and user experience are as follows.")]),e._v(" "),a("h3",{attrs:{id:"unsized-images-hurt-cls"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#unsized-images-hurt-cls"}},[e._v("#")]),e._v(" Unsized images hurt CLS")]),e._v(" "),a("p",[e._v("Images served without their size specified can cause layout instability and contribute to a high Cumulative Layout Shift ("),a("a",{attrs:{href:"https://web.dev/cls/",target:"_blank",rel:"noopener noreferrer"}},[e._v("CLS"),a("OutboundLink")],1),e._v("). Setting the "),a("code",[e._v("width")]),e._v(" and "),a("code",[e._v("height")]),e._v(" attributes on "),a("a",{attrs:{href:"https://web.dev/patterns/web-vitals-patterns/images/img-tag/",target:"_blank",rel:"noopener noreferrer"}},[e._v("img"),a("OutboundLink")],1),e._v(" elements can help to prevent layout shifts. For example:")]),e._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("<")]),e._v("img")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')]),e._v("flower.jpg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')])]),e._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("width")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')]),e._v("360"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')])]),e._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("height")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')]),e._v("240"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")])]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("The width and height should be set such that the aspect ratio of the rendered image is close to its natural aspect ratio. A significant "),a("a",{attrs:{href:"https://web.dev/image-aspect-ratio/",target:"_blank",rel:"noopener noreferrer"}},[e._v("difference in the aspect ratio"),a("OutboundLink")],1),e._v(" can result in the image looking distorted. A relatively new property that allows you to specify "),a("a",{attrs:{href:"https://web.dev/aspect-ratio/",target:"_blank",rel:"noopener noreferrer"}},[e._v("aspect-ratio in CSS"),a("OutboundLink")],1),e._v(" can help to size images responsively while preventing CLS.")]),e._v(" "),a("h3",{attrs:{id:"large-images-can-hurt-lcp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#large-images-can-hurt-lcp"}},[e._v("#")]),e._v(" Large images can hurt LCP")]),e._v(" "),a("p",[e._v('The larger the file size of an image, the longer it will take to download. A large image could be the "hero" image for the page or the most significant element in the viewport responsible for triggering the Largest Contentful Paint ('),a("a",{attrs:{href:"https://web.dev/lcp/",target:"_blank",rel:"noopener noreferrer"}},[e._v("LCP"),a("OutboundLink")],1),e._v("). An image that is part of the critical content and takes a long time to download will delay the LCP.")]),e._v(" "),a("p",[e._v("In many cases, developers can reduce image sizes through better compression and the use of "),a("a",{attrs:{href:"https://developer.mozilla.org/docs/Learn/HTML/Multimedia_and_embedding/Responsive_images#how_do_you_create_responsive_images",target:"_blank",rel:"noopener noreferrer"}},[e._v("responsive"),a("OutboundLink")],1),e._v(" images. The "),a("code",[e._v("srcset")]),e._v(" and "),a("code",[e._v("sizes")]),e._v(" attributes of the "),a("code",[e._v("<img>")]),e._v(" element help to provide image files with different sizes. The browser can then choose the right one depending on the screen size and resolution.")]),e._v(" "),a("h3",{attrs:{id:"poor-image-compression-can-hurt-lcp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#poor-image-compression-can-hurt-lcp"}},[e._v("#")]),e._v(" Poor image compression can hurt LCP")]),e._v(" "),a("p",[e._v("Modern image formats like "),a("a",{attrs:{href:"https://web.dev/compress-images-avif/",target:"_blank",rel:"noopener noreferrer"}},[e._v("AVIF"),a("OutboundLink")],1),e._v(" or "),a("a",{attrs:{href:"https://web.dev/serve-images-webp/",target:"_blank",rel:"noopener noreferrer"}},[e._v("WebP"),a("OutboundLink")],1),e._v(" can provide better compression than commonly used JPEG and PNG formats. Better compression reduces the file size by 25% to 50% in some cases for the same quality of the image. This reduction leads to faster downloads with less data consumption. The app should "),a("a",{attrs:{href:"https://web.dev/uses-webp-images/",target:"_blank",rel:"noopener noreferrer"}},[e._v("serve modern image formats"),a("OutboundLink")],1),e._v(" to browsers that support these formats.")]),e._v(" "),a("h3",{attrs:{id:"loading-unnecessary-images-hurts-lcp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#loading-unnecessary-images-hurts-lcp"}},[e._v("#")]),e._v(" Loading unnecessary images hurts LCP")]),e._v(" "),a("p",[e._v("Images below the fold or not in the viewport are not displayed to the user when the page is loaded. They can be deferred so that they do not contribute to the LCP and delay it. "),a("a",{attrs:{href:"https://web.dev/lazy-loading-images/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Lazy-loading"),a("OutboundLink")],1),e._v(" can be used to load such images later as the user scrolls towards them.")]),e._v(" "),a("h2",{attrs:{id:"optimization-challenges"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#optimization-challenges"}},[e._v("#")]),e._v(" Optimization challenges")]),e._v(" "),a("p",[e._v("Teams can evaluate the performance cost due to the issues listed previously and implement best practice solutions to overcome them. However, this often does not happen in practice, and inefficient images continue to slow down the web. Possible reasons for this include:")]),e._v(" "),a("ul",[a("li",[a("p",[a("strong",[e._v("Priorities")]),e._v(": Web developers usually tend to focus on code, JavaScript, and data optimization. As such, they may not be aware of issues with images or how to optimize them. Images created by designers or uploaded by users may not be high in the list of priorities.")])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("Out-of-the-box solution")]),e._v(": Even if developers are aware of the nuances of image optimization, the absence of an all-in-one out-of-the-box solution for their framework or tech-stack may be a deterrent.")])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("Dynamic images")]),e._v(": In addition to static images that are part of the application, dynamic images are uploaded by users or sourced from external databases or CMS's. It may be challenging to define the size of such images where the source of the image is dynamic.")])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("Markup overload")]),e._v(": Solutions for including the image size or "),a("code",[e._v("srcset")]),e._v(" for different sizes require additional markup for every image, which can be tedious. The "),a("code",[e._v("srcset")]),e._v(" attribute was introduced in 2014 but is "),a("a",{attrs:{href:"https://almanac.httparchive.org/en/2020/media#srcset",target:"_blank",rel:"noopener noreferrer"}},[e._v("used by only 26.5%"),a("OutboundLink")],1),e._v(" of the websites today. When using srcset, developers have to create images in various sizes. Tools such as "),a("a",{attrs:{href:"https://just-gimme-an-img.vercel.app/",target:"_blank",rel:"noopener noreferrer"}},[e._v("just-gimme-an-img"),a("OutboundLink")],1),e._v(" can help but have to be used manually for every image.")])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("Browser support")]),e._v(": Modern image formats like AVIF and WebP create smaller image files but need special handling on browsers that don't support them. Developers have to use strategies like "),a("a",{attrs:{href:"https://developer.mozilla.org/docs/Web/HTTP/Content_negotiation",target:"_blank",rel:"noopener noreferrer"}},[e._v("content negotiation"),a("OutboundLink")],1),e._v(" or the element so that images are served to all browsers.")])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("Lazy loading complications")]),e._v(': There are multiple techniques and libraries available to implement lazy-loading for below-the-fold images. Picking the best one can be a challenge. Developers may also not know the best distance from the "fold" to load deferred images. Different viewport sizes on devices can further complicate this.')])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("Changing landscape")]),e._v(": As browsers start supporting new HTML or CSS features to enhance performance, it may be difficult for developers to evaluate each of them. For example, Chrome is introducing the "),a("a",{attrs:{href:"https://web.dev/priority-hints",target:"_blank",rel:"noopener noreferrer"}},[e._v("Priority Hints"),a("OutboundLink")],1),e._v(" feature as an "),a("a",{attrs:{href:"https://web.dev/blog/origin-trials/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Origin Trial"),a("OutboundLink")],1),e._v(". It can be used to boost the priority of specific images on the page. Overall, developers would find it easier if such enhancements were evaluated and implemented at the component level.")])])]),e._v(" "),a("h2",{attrs:{id:"image-component-as-a-solution"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#image-component-as-a-solution"}},[e._v("#")]),e._v(" Image component as a solution")]),e._v(" "),a("p",[e._v("The opportunities available to optimize images and the challenges in implementing them individually for every application led us to the idea of an image component. An image component can encapsulate and enforce best practices. By replacing the "),a("code",[e._v("<img>")]),e._v(" element with an image component, developers can better address their image performance woes.")]),e._v(" "),a("p",[e._v("Over the last year, we have worked with the "),a("a",{attrs:{href:"https://nextjs.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Next.js"),a("OutboundLink")],1),e._v(" framework to design and "),a("a",{attrs:{href:"https://github.com/vercel/next.js/blob/canary/packages/next/client/image.tsx",target:"_blank",rel:"noopener noreferrer"}},[e._v("implement"),a("OutboundLink")],1),e._v(" their "),a("a",{attrs:{href:"https://nextjs.org/docs/api-reference/next/image",target:"_blank",rel:"noopener noreferrer"}},[e._v("Image component"),a("OutboundLink")],1),e._v(". It can be used as a drop-in replacement for the existing "),a("code",[e._v("<img>")]),e._v(" elements in Next.js apps as follows.")]),e._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Before with <img> element:")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("Logo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("img src"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"/logo.jpg"')]),e._v(" alt"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"logo"')]),e._v(" height"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"200"')]),e._v(" width"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"100"')]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// After with image component:")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" Image "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'next/image'")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("Logo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("Image src"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"/logo.jpg"')]),e._v(" alt"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"logo"')]),e._v(" height"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"200"')]),e._v(" width"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"100"')]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br")])]),a("p",[e._v("The component tries to address image-related problems generically through a rich set of features and principles. It also includes options that allow developers to customize it for various image requirements.")]),e._v(" "),a("h3",{attrs:{id:"protection-from-layout-shifts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#protection-from-layout-shifts"}},[e._v("#")]),e._v(" Protection from layout shifts")]),e._v(" "),a("p",[e._v("As discussed previously, unsized images cause layout shifts and contribute to CLS. When using the Next.js Image component, developers must provide an image size using the "),a("code",[e._v("width")]),e._v(" and "),a("code",[e._v("height")]),e._v(" attributes to prevent any layout shifts. If the size is unknown, developers must specify "),a("a",{attrs:{href:"https://nextjs.org/docs/api-reference/next/image#layout",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("layout=fill")]),a("OutboundLink")],1),e._v(" to serve an unsized image that sits inside a sized container. Alternatively you can use static image imports to retrieve the size of the actual image on the hard drive at build time and include it in the image.")]),e._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[e._v("// Image component with width and height specified\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("<")]),e._v("Image")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')]),e._v("/logo.jpg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')])]),e._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("alt")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')]),e._v("logo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')])]),e._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("height")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')]),e._v("200"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')])]),e._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("width")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')]),e._v("100"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')])]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("/>")])]),e._v("\n\n// Image component with layout specified\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("<")]),e._v("Image")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')]),e._v("/hero.jpg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')])]),e._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("layout")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')]),e._v("fill"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')])]),e._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("objectFit")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')]),e._v("cover"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')])]),e._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("alt")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')]),e._v("hero"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')])]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("/>")])]),e._v("\n\n// Image component with image import\nimport Image from 'next/image'\nimport logo from './logo.png'\n\nfunction Logo() {\n  return "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("<")]),e._v("Image")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[e._v("=")]),e._v("{logo}")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("alt")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')]),e._v("logo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')])]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("/>")])]),e._v("\n}\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br")])]),a("p",[e._v("Since developers cannot use the Image component unsized, the design ensures that they will take the time to consider image sizing and prevent layout shifts.")]),e._v(" "),a("h3",{attrs:{id:"facilitate-responsiveness"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#facilitate-responsiveness"}},[e._v("#")]),e._v(" Facilitate responsiveness")]),e._v(" "),a("p",[e._v("To make images responsive across devices, developers must set the "),a("code",[e._v("srcset")]),e._v(" and "),a("code",[e._v("sizes")]),e._v(" attributes in the "),a("code",[e._v("<img>")]),e._v(" element. We wanted to reduce this effort with the Image component. We designed the Next.js Image component to set the attribute values only once per application. We apply them to all instances of the Image component based on the layout mode. We came up with a three-part solution:")]),e._v(" "),a("ol",[a("li",[a("p",[a("code",[e._v("deviceSizes")]),e._v(" property: This property can be used to configure breakpoints one-time based on the devices common to the application user base. The default values for breakpoints are included in the config file.")])]),e._v(" "),a("li",[a("p",[a("code",[e._v("imageSizes")]),e._v(" property: This is also a configurable property used to get the image sizes corresponding to device size breakpoints.")])]),e._v(" "),a("li",[a("p",[a("code",[e._v("layout")]),e._v(" attribute in each image: This is used to indicate how to use the "),a("code",[e._v("deviceSizes")]),e._v(" and "),a("code",[e._v("imageSizes")]),e._v(" properties for each image. The supported values for layout mode are "),a("code",[e._v("fixed")]),e._v(", "),a("code",[e._v("fill")]),e._v(", "),a("code",[e._v("intrinsic")]),e._v(" and "),a("code",[e._v("responsive")])])])]),e._v(" "),a("p",[e._v("When an image is requested with layout modes responsive or "),a("em",[e._v("fill")]),e._v(", Next.js identifies the image to be served based on the size of the device requesting the page and sets the "),a("code",[e._v("srcset")]),e._v(" and "),a("code",[e._v("sizes")]),e._v(" in the image appropriately.")]),e._v(" "),a("p",[e._v("The following comparison shows how the layout mode can be used to control the size of the image on different screens. We have used a "),a("a",{attrs:{href:"https://image-component.nextjs.gallery/layout-intrinsic",target:"_blank",rel:"noopener noreferrer"}},[e._v("demo image"),a("OutboundLink")],1),e._v(" shared in the Next.js docs, viewed on a phone and a standard laptop.")]),e._v(" "),a("table",[a("tr",[a("th",[e._v("Laptop screen")]),a("th",[e._v("Phone screen")])]),e._v(" "),a("tr",[a("td",{attrs:{colspan:"2"}},[e._v("\n        Layout = Intrinsic: Scales down to fit the container's width on smaller viewports. Does not scale up beyond the image's intrinsic size on a larger viewport. Container width is at 100%\n      ")])]),e._v(" "),a("tr",[a("td",[a("img",{attrs:{src:"https://web-dev.imgix.net/image/IypihH3o5cSpEMVp5i08dp69otp2/qQ6WnlG5OwWX4q75ahap.png?auto=format&w=400"}})]),e._v(" "),a("td",[a("img",{attrs:{src:"https://web-dev.imgix.net/image/IypihH3o5cSpEMVp5i08dp69otp2/d4prulPcCUl0J4lytrBF.png?auto=format&w=250"}})])]),e._v(" "),a("tr",[a("td",{attrs:{colspan:"2"}},[e._v("\n        Layout = Fixed: Image is not responsive. Width and height are fixed similar to `` element irrespective of the device where it is rendered.\n      ")])]),e._v(" "),a("tr",[a("td",[a("img",{attrs:{src:"https://web-dev.imgix.net/image/IypihH3o5cSpEMVp5i08dp69otp2/UCZZHaEWh0x807gPXYhj.png?auto=format&w=400"}})]),e._v(" "),a("td",[a("img",{attrs:{src:"https://web-dev.imgix.net/image/IypihH3o5cSpEMVp5i08dp69otp2/pkTbqgBlpi8K5ByzUo9Y.png?auto=format&w=250"}})])]),e._v(" "),a("tr",[a("td",{attrs:{colspan:"2"}},[e._v("\n        Layout = Responsive: Scale down or scale up depending on the width of the container on different viewports, maintaining aspect ratio.\n      ")])]),e._v(" "),a("tr",[a("td",[a("img",{attrs:{src:"https://web-dev.imgix.net/image/IypihH3o5cSpEMVp5i08dp69otp2/DrAhreYxIqszQaszOSGD.png?auto=format&w=400"}})]),e._v(" "),a("td",[a("img",{attrs:{src:"https://web-dev.imgix.net/image/IypihH3o5cSpEMVp5i08dp69otp2/RasQtoFPckwrghdcfCqr.png?auto=format&w=250"}})])]),e._v(" "),a("tr",[a("td",{attrs:{colspan:"2"}},[e._v("\n        Layout = Fill: Width and height stretched to fill the parent container. (Parent `\n` width is set to 300*500 in this example)\n      ")])]),e._v(" "),a("tr",[a("td",[a("img",{attrs:{src:"https://web-dev.imgix.net/image/IypihH3o5cSpEMVp5i08dp69otp2/XJlHRpBH4EUngVgkA43k.png?auto=format&w=400"}})]),e._v(" "),a("td",[a("img",{attrs:{src:"https://web-dev.imgix.net/image/IypihH3o5cSpEMVp5i08dp69otp2/LOjRUgoxcVrxXfqptKm5.png?auto=format&w=250"}})])])]),e._v(" "),a("h3",{attrs:{id:"provide-built-in-lazy-loading"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#provide-built-in-lazy-loading"}},[e._v("#")]),e._v(" Provide built-in lazy-loading")]),e._v(" "),a("p",[e._v("The Image component provides a built-in, performant "),a("a",{attrs:{href:"https://nextjs.org/docs/api-reference/next/image#loading",target:"_blank",rel:"noopener noreferrer"}},[e._v("lazy loading"),a("OutboundLink")],1),e._v(" solution as a default. When using the "),a("code",[e._v("<img>")]),e._v(" element, there are a few native options for lazy loading, but they all have drawbacks that make them tricky to use. A developer might adopt one of the following lazy loading approaches:")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("Specify the "),a("a",{attrs:{href:"https://developer.mozilla.org/docs/Web/HTML/Element/img#attr-loading",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("loading")]),a("OutboundLink")],1),e._v(" attribute: This is easy to implement but currently "),a("a",{attrs:{href:"https://caniuse.com/?search=loading",target:"_blank",rel:"noopener noreferrer"}},[e._v("unsupported"),a("OutboundLink")],1),e._v(" on some browsers.")])]),e._v(" "),a("li",[a("p",[e._v("Use the "),a("a",{attrs:{href:"https://developer.mozilla.org/docs/Web/API/Intersection_Observer_API",target:"_blank",rel:"noopener noreferrer"}},[e._v("Intersection Observer API"),a("OutboundLink")],1),e._v(": Building a custom lazy-loading solution requires effort and a thoughtful design and implementation. Developers may not always have the time for this.")])]),e._v(" "),a("li",[a("p",[e._v("Import a third-party library to lazy-load images: Additional effort may be required to evaluate and integrate a suitable third-party library for lazy loading.")])])]),e._v(" "),a("p",[e._v("In the Next.js Image component, loading is set to "),a("code",[e._v('"lazy"')]),e._v(" by default. Lazy loading is implemented using Intersection Observer, which is "),a("a",{attrs:{href:"https://caniuse.com/?search=IntersectionObserver",target:"_blank",rel:"noopener noreferrer"}},[e._v("available on most modern browsers"),a("OutboundLink")],1),e._v(". Developers are not required to do anything extra to enable it, but they can disable it when needed.")]),e._v(" "),a("h3",{attrs:{id:"preload-important-images"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#preload-important-images"}},[e._v("#")]),e._v(" Preload important images")]),e._v(" "),a("p",[e._v("Quite often, LCP elements are images, and large images can delay LCP. It is a good idea to "),a("a",{attrs:{href:"https://web.dev/preload-critical-assets/",target:"_blank",rel:"noopener noreferrer"}},[e._v("preload critical images"),a("OutboundLink")],1),e._v(" so the browser can discover that image sooner. When using an "),a("code",[e._v("<img>")]),e._v(" element, a preload hint may be included in the HTML head as follows.")]),e._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("<")]),e._v("link")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("rel")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')]),e._v("preload"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')])]),e._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("as")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')]),e._v("image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')])]),e._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("href")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')]),e._v("important.png"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")])]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("A well-designed image component should offer a way to tweak the loading sequence of images, regardless of the framework used. In the case of the Next.js Image component, developers can indicate an image that is a good candidate for preload using the "),a("a",{attrs:{href:"https://nextjs.org/docs/api-reference/next/image#priority",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("priority")]),a("OutboundLink")],1),e._v(" attribute of the images component.")]),e._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("<")]),e._v("Image")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')]),e._v("/hero.jpg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')])]),e._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("alt")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')]),e._v("hero"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')])]),e._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("height")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')]),e._v("400"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')])]),e._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("width")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')]),e._v("200"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')])]),e._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("priority")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("/>")])]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("Adding a "),a("code",[e._v("priority")]),e._v(" attribute simplifies markup and is more convenient to use. Image component developers can also explore options to apply heuristics to automate preloading for above-the-fold images on the page that meet specific criteria.")]),e._v(" "),a("h3",{attrs:{id:"encourage-high-performance-image-hosting"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#encourage-high-performance-image-hosting"}},[e._v("#")]),e._v(" Encourage high-performance image hosting")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://web.dev/image-cdns/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Image CDNs"),a("OutboundLink")],1),e._v(" are recommended for automating image optimization, and they also support "),a("a",{attrs:{href:"https://web.dev/uses-webp-images/",target:"_blank",rel:"noopener noreferrer"}},[e._v("modern image formats"),a("OutboundLink")],1),e._v(" like WebP and AVIF. The Next.js Image component uses an image CDN by default using a "),a("a",{attrs:{href:"https://nextjs.org/docs/api-reference/next/image#loader",target:"_blank",rel:"noopener noreferrer"}},[e._v("loader architecture"),a("OutboundLink")],1),e._v(". The following example shows that the loader allows for configuration of the CDN in the Next.js config file.")]),e._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[e._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("images")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("loader")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'imgix'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("path")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'https://ImgApp/imgix.net'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br")])]),a("p",[e._v("With this configuration, developers can use relative URLs in the image source, and the framework will concatenate the relative URL with the CDN path to generate the absolute URL. Popular image CDNs like "),a("a",{attrs:{href:"https://imgix.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Imgix"),a("OutboundLink")],1),e._v(", "),a("a",{attrs:{href:"https://cloudinary.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Cloudinary"),a("OutboundLink")],1),e._v(", and "),a("a",{attrs:{href:"https://www.akamai.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Akamai"),a("OutboundLink")],1),e._v(" are supported. The architecture supports the use of a custom cloud provider by implementing a custom "),a("a",{attrs:{href:"https://nextjs.org/docs/api-reference/next/image#loader",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("loader")]),a("OutboundLink")],1),e._v(" function for the app.")]),e._v(" "),a("h3",{attrs:{id:"support-self-hosted-images"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#support-self-hosted-images"}},[e._v("#")]),e._v(" Support self-hosted images")]),e._v(" "),a("p",[e._v("There may be situations where websites cannot use image CDNs. In such cases, an image component must support self-hosted images. The Next.js Image component uses an "),a("a",{attrs:{href:"https://nextjs.org/docs/basic-features/image-optimization",target:"_blank",rel:"noopener noreferrer"}},[e._v("image optimizer"),a("OutboundLink")],1),e._v(" as a built-in image server that provides a CDN-like API. The optimizer uses "),a("a",{attrs:{href:"https://www.npmjs.com/package/sharp",target:"_blank",rel:"noopener noreferrer"}},[e._v("Sharp"),a("OutboundLink")],1),e._v(" for production image transformations if it is installed on the server. This library is a good choice for anyone looking to build their own image optimization pipeline.")]),e._v(" "),a("h3",{attrs:{id:"support-progressive-loading"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#support-progressive-loading"}},[e._v("#")]),e._v(" Support progressive loading")]),e._v(" "),a("p",[e._v("Progressive loading is a technique used to hold users' interest by displaying a placeholder image usually of significantly lower quality while the actual image loads. It improves perceived performance and enhances the user experience. It can be used in combination with lazy loading for below-the-fold images or for above-the-fold images.")]),e._v(" "),a("p",[e._v("The Next.js Image component supports progressive loading for the image through the "),a("a",{attrs:{href:"https://nextjs.org/docs/api-reference/next/image#placeholder",target:"_blank",rel:"noopener noreferrer"}},[e._v("placeholder"),a("OutboundLink")],1),e._v(" property. This can be used as an "),a("a",{attrs:{href:"https://web.dev/lazy-loading-best-practices/#wrong-layout-shifting",target:"_blank",rel:"noopener noreferrer"}},[e._v("LQIP"),a("OutboundLink")],1),e._v(" (Low-quality image placeholder) for displaying a low-quality or blurred image while the actual image loads.")]),e._v(" "),a("h2",{attrs:{id:"impact"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#impact"}},[e._v("#")]),e._v(" Impact")]),e._v(" "),a("p",[e._v("With all the above optimizations incorporated, we have seen success with the Next.js Image component in production and are also working with other tech stacks on similar image components.")]),e._v(" "),a("p",[e._v("When "),a("a",{attrs:{href:"https://www.leboncoin.fr/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Leboncoin"),a("OutboundLink")],1),e._v(" "),a("a",{attrs:{href:"https://medium.com/leboncoin-engineering-blog/how-we-are-improving-our-web-performance-9f850d59d810",target:"_blank",rel:"noopener noreferrer"}},[e._v("migrated their legacy JavaScript frontend to Next.js"),a("OutboundLink")],1),e._v(", they also upgraded their image pipeline to use the Next.js Image component. On a page that migrated from "),a("img"),e._v(" to next/image, LCP went down from 2.4s to 1.7s. The total image bytes downloaded for the page went from 663kB to 326kB (with ~100kB of lazy-loaded image bytes).")]),e._v(" "),a("h2",{attrs:{id:"lessons-learned"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#lessons-learned"}},[e._v("#")]),e._v(" Lessons Learned")]),e._v(" "),a("p",[e._v("Anyone creating a Next.js app can benefit from using the Next.js Image component for optimization. However, if you want to build similar performance abstractions for another framework or CMS, the following are a few lessons we learned along the way that could be helpful.")]),e._v(" "),a("h3",{attrs:{id:"safety-valves-can-cause-more-harm-than-good"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#safety-valves-can-cause-more-harm-than-good"}},[e._v("#")]),e._v(" Safety valves can cause more harm than good")]),e._v(" "),a("p",[e._v("In an early release of the Next.js Image component, we provided a "),a("code",[e._v("unsized")]),e._v(" attribute that allowed developers to bypass the sizing requirement, and use images with unspecified dimensions. We thought this would be a necessary in instances where it was impossible to know the image's height or width in advance. However, we noticed users recommending the "),a("code",[e._v("unsized")]),e._v(" attribute in GitHub issues as a catch-all solution to problems with the sizing requirement, even in cases where they could solve the problem in ways that didn't worsen CLS. We subsequently deprecated and removed the "),a("code",[e._v("unsized")]),e._v(" attribute.")]),e._v(" "),a("h3",{attrs:{id:"separate-useful-friction-from-pointless-annoyance"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#separate-useful-friction-from-pointless-annoyance"}},[e._v("#")]),e._v(" Separate useful friction from pointless annoyance")]),e._v(" "),a("p",[e._v('The requirement for sizing an image is an example of "useful friction." It restricts the use of the component, but it provides outsized performance benefits in exchange. Users will readily accept the constraint if they have a clear picture of the potential performance benefits. Therefore, it is worthwhile to explain this tradeoff in the documentation and other published material about the component.')]),e._v(" "),a("p",[e._v("However, you can find workarounds for such friction without sacrificing performance. For example, during the development of the Next.js Image component, we received complaints that it was annoying to look up sizes for locally stored images. We added "),a("a",{attrs:{href:"https://nextjs.org/docs/basic-features/image-optimization#image-imports",target:"_blank",rel:"noopener noreferrer"}},[e._v("static image imports"),a("OutboundLink")],1),e._v(", which streamline this process by automatically retrieving dimensions for local images at build time using a Babel plugin.")]),e._v(" "),a("h3",{attrs:{id:"strike-a-balance-between-convenience-features-and-performance-optimizations"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#strike-a-balance-between-convenience-features-and-performance-optimizations"}},[e._v("#")]),e._v(" Strike a balance between convenience features and performance optimizations")]),e._v(" "),a("p",[e._v('If your image component does nothing but impose "useful friction" on its users, developers will tend to not want to use it. We found that although performance features like image sizing and automatic generation of '),a("code",[e._v("srcset")]),e._v(" values were the most important. Developer-facing convenience features like automatic lazy loading and "),a("a",{attrs:{href:"https://nextjs.org/docs/api-reference/next/image#placeholder",target:"_blank",rel:"noopener noreferrer"}},[e._v("built-in blurry placeholders"),a("OutboundLink")],1),e._v(" also drove interest in the Next.js Image component.")]),e._v(" "),a("h3",{attrs:{id:"set-a-roadmap-for-features-to-drive-adoption"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#set-a-roadmap-for-features-to-drive-adoption"}},[e._v("#")]),e._v(" Set a roadmap for features to drive adoption")]),e._v(" "),a("p",[e._v('Building a solution that works perfectly for all situations is very difficult. It can be tempting to design something that works well for 75% of people and then tell the other 25% that "in these cases, this component isn\'t for you."')]),e._v(" "),a("p",[e._v("In practice, this strategy turns out to be at odds with your goals as a component designer. You want developers to adopt your component in order to benefit from its performance benefits. This is difficult to do if there is a contingent of users that are unable to migrate and feel left out of the conversation. They are likely to express disappointment, leading to negative perceptions that affect adoption.")]),e._v(" "),a("p",[e._v("It is advisable to have a roadmap for your component that covers all reasonable use cases over the long term. It also helps to be explicit in the documentation about what isn't supported and why in order to set expectations about the problems the component is intended to solve.")]),e._v(" "),a("h2",{attrs:{id:"conclusion"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#conclusion"}},[e._v("#")]),e._v(" Conclusion")]),e._v(" "),a("p",[e._v("Image usage and optimization is complicated. Developers have to find the balance between performance and quality of images while ensuring a great user experience. This makes image optimization a high-cost, high-impact endeavor.")]),e._v(" "),a("p",[e._v("Instead of having each app reinvent the wheel every time, we came up with a best practices template that developers, frameworks, and other tech-stacks could use as a reference for their own implementations. This experience will indeed prove valuable as we support other frameworks, on their image components.")]),e._v(" "),a("p",[e._v("The Next.js Image component has successfully improved performance outcomes in Next.js applications, thereby enhancing the user experience. We believe that it's a great model that would work well in the broader ecosystem, and we would love to hear from developers who would like to adopt this model in their projects.")]),e._v(" "),a("hr"),e._v(" "),a("blockquote",[a("ul",[a("li",[e._v(""),a("a",{attrs:{href:"https://github.com/FEDarling/weekly-tracker",target:"_blank",rel:"noopener noreferrer"}},[e._v("weekly-tracker"),a("OutboundLink")],1),e._v(" ")]),e._v(" "),a("li",[a("a",{attrs:{href:"https://web.dev/image-component/",target:"_blank",rel:"noopener noreferrer"}},[e._v(""),a("OutboundLink")],1),e._v("")]),e._v(" "),a("li",[e._v(""),a("a",{attrs:{href:"https://github.com/FEDarling/weekly-tracker/blob/main/weeklys/frontend_focus/514/building_an_effective_image_component.md",target:"_blank",rel:"noopener noreferrer"}},[e._v(" PR"),a("OutboundLink")],1)]),e._v(" "),a("li",[e._v("")]),e._v(" "),a("li",[e._v("")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);